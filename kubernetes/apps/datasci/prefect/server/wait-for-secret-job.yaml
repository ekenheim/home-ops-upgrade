---
apiVersion: batch/v1
kind: Job
metadata:
  name: wait-for-prefect-secret
  namespace: datasci
spec:
  ttlSecondsAfterFinished: 100
  template:
    spec:
      containers:
      - name: wait
        image: bitnami/kubectl:latest
        command:
        - /bin/sh
        - -c
        - |
          until kubectl get secret prefect-secret -n datasci; do
            echo "Waiting for prefect-secret to be created..."
            sleep 5
          done
      restartPolicy: OnFailure
