---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gitlab
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: doppler
  target:
    name: gitlab-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        INITIAL_ROOT_PASSWORD: "{{ .GITLAB_ROOT_PASSWORD }}"
        GITLAB_DB_HOST: "{{ .POSTGRES_HOST }}"
        GITLAB_DB_NAME: "{{ .GITLAB_DB_NAME }}"
        GITLAB_DB_USERNAME: "{{ .GITLAB_DB_USERNAME }}"
        GITLAB_DB_PASSWORD: "{{ .GITLAB_DB_PASSWORD }}"
        SMTP_PASSWORD: "{{ .GITLAB_SMTP_PASSWORD }}"
        # GITLAB RUNNER
        runner-registration-token: "{{ .RUNNER_REGISTRATION_TOKEN }}"
        runner-token: "{{ .GITLAB_TOKEN_SECRET }}"
        # SMTP
        SMTP_SERVER: "{{ .SMTP_SERVER }}"
        SMTP_USERNAME: "{{ .GITLAB_SMTP_USERNAME }}"
        SMTP_PORT: "{{ .SMTP_PORT }}"

        # accesskey: "{{ .minio_accesskey }}"
        # secretkey: "{{ .minio_secretkey }}"
        # provider: AWS
        # region: us-east-1
        # aws_access_key_id: "{{ .minio_accesskey }}"
        # aws_secret_access_key: "{{ .minio_secretkey }}"
        #endpoint: "{{ .endpoint }}"
  dataFrom:
    - extract:
        key: GITLAB
    - extract:
        key: CLOUDNATIVE_PG
    - extract:
        key: SMTP
